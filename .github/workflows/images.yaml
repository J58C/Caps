name: Images Render
on:
  push:
    branches:
      - '42'
    paths:
      - 'Caps32Project.kicad_pcb'
jobs:
  render-images:
    name: PCB Render
    runs-on: ubuntu-latest
    steps:
      - name: Check Out the Repo (Branch 42)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: '42'  # Checkout branch 42

      - name: Render PCB Images
        uses: linalinn/kicad-render@main
        with:
          pcb_file: Caps32Project.kicad_pcb
          output_path: ${{ github.workspace }}/images
          
      - name: Render PCB GIF
        uses: linalinn/kicad-render@main
        with:
          pcb_file: Caps32Project.kicad_pcb
          output_path: ${{ github.workspace }}/images
          animation: gif

      - name: Commit and Push Rendered Images to Branch 42
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add images/*  # Staging images for commit in branch 42
          git commit -m "Update PCB render images"
          git push origin 42  # Push changes to branch 42

      - name: Check Out Branch Main
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: 'main'  # Checkout branch main

      - name: Create Folder and Move Images to "Images/42" in Branch Main
        run: |
          mkdir -p ${{ github.workspace }}/Images/42
          mv ${{ github.workspace }}/images/* ${{ github.workspace }}/Images/42/

      - name: Commit and Push Images to Branch Main
        run: |
          git add Images/42/*  # Staging the images in Images/42 folder
          git commit -m "Move PCB render images from branch 42 to Images/42"
          git push origin main  # Push changes to branch main

      - name: Remove 'images' Folder from Branch 42
        run: |
          git checkout 42  # Make sure we're on branch 42 again
          rm -rf ${{ github.workspace }}/images  # Remove the images folder
          git add .  # Stage the removal of the images folder
          git commit -m "Remove images folder after moving to main"
          git push origin 42  # Push the removal to branch 42